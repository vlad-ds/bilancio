name: Keep Supabase Active

on:
  schedule:
    # Run every 3 days at midnight UTC
    - cron: '0 0 */3 * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"

      - name: Set up Python
        run: uv python install 3.12

      - name: Install dependencies
        run: uv sync

      - name: Ping Supabase
        env:
          BILANCIO_SUPABASE_URL: ${{ secrets.BILANCIO_SUPABASE_URL }}
          BILANCIO_SUPABASE_ANON_KEY: ${{ secrets.BILANCIO_SUPABASE_ANON_KEY }}
        run: |
          uv run python -c "
          from bilancio.storage.supabase_client import get_supabase_client
          client = get_supabase_client()
          result = client.table('jobs').select('job_id').limit(1).execute()
          print('Successfully pinged Supabase!')
          print(f'Sample response: {result.data[:1] if result.data else \"(no jobs yet)\"}')
          "
